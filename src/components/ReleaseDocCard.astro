---
import type { Doc } from "../types/api";

interface Props {
  doc: Doc;
}

const { doc } = Astro.props;

const launchDate = new Date(doc.date_utc).toLocaleDateString("es-ES", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

let statusText: string;
let statusColorClass: string;

if (doc.upcoming) {
  statusText = "PrÃ³ximo";
  statusColorClass = "bg-blue-200 text-blue-800";
} else if (doc.success) {
  statusText = "Ã‰xito";
  statusColorClass = "bg-green-200 text-green-800";
} else {
  statusText = "Fallo";
  statusColorClass = "bg-red-200 text-red-800";
}
---

<article
  class="flex flex-col rounded-lg bg-gray-800/50 shadow-lg overflow-hidden border border-gray-700 hover:border-blue-500 transition-colors duration-300"
>
  <a
    href={`/midudev-astro3/release/${doc.id}`}
    rel="noopener noreferrer"
    class="block"
  >
    <img
      src={doc.links.patch.large || "/placeholder.png"}
      alt={`Parche de la misiÃ³n ${doc.name}`}
      class="w-full h-60 object-contain bg-gray-900/50 p-4"
    />
  </a>

  <div class="p-6 flex flex-col flex-grow">
    <header class="flex justify-between items-start mb-2">
      <h2 class="text-2xl font-bold text-white pr-4">{doc.name}</h2>
      <span
        class:list={[
          "text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",
          statusColorClass,
        ]}
      >
        {statusText}
      </span>
    </header>

    <p class="text-sm text-gray-400 mb-4">
      <strong>Vuelo #{doc.flight_number}</strong> &bull; {launchDate}
    </p>

    {
      doc.details && (
        <p class="text-gray-300 text-base mb-6 flex-grow">
          {doc.details.length > 100
            ? `${doc.details.substring(0, 100)}...`
            : doc.details}
        </p>
      )
    }

    <footer
      class="mt-auto pt-4 border-t border-gray-700/50 flex gap-3 flex-wrap"
    >
      {
        doc.links.article && (
          <a
            href={doc.links.article}
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm bg-gray-700 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded transition-colors duration-200"
          >
            ArtÃ­culo ðŸ“°
          </a>
        )
      }
      {
        doc.links.wikipedia && (
          <a
            href={doc.links.wikipedia}
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm bg-gray-700 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded transition-colors duration-200"
          >
            Wikipedia ðŸ“š
          </a>
        )
      }
      {
        doc.links.webcast && (
          <a
            href={doc.links.webcast}
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm bg-gray-700 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded transition-colors duration-200"
          >
            Ver Lanzamiento ðŸš€
          </a>
        )
      }
    </footer>
  </div>
</article>
